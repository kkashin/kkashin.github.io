<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Bootstrap Confidence Interval Methods in R | Konstantin Kashin </title> <meta name="description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta name="keywords" content="artificial intelligence, AI, data science, engineering, causal inference, A/B testing, experimentation, optimization"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Konstantin Kashin"> <meta property="article:section" content="blog"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2013-08-01 00:00:00 -0400"> <meta property="og:url" content="http://kkashin.com/2013/bootstrap-confidence-interval-methods-in-r/"> <meta property="og:title" content=" Bootstrap Confidence Interval Methods in R | Konstantin Kashin "> <meta property="og:image" content="http://kkashin.com"> <meta property="og:description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta property="og:site_name" content="Konstantin Kashin"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Bootstrap Confidence Interval Methods in R | Konstantin Kashin "> <meta name="twitter:description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta name="twitter:image:src" content="http://kkashin.com"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Bootstrap Confidence Interval Methods in R | Konstantin Kashin "> <meta itemprop="description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta itemprop="image" content="http://kkashin.com"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="shortcut icon" type="image/png" href="/assets/images/favicon-32x32.png"> <!-- Canonical link tag --> <link rel="canonical" href="http://kkashin.com/2013/bootstrap-confidence-interval-methods-in-r/"> <link rel="alternate" type="application/rss+xml" title="Konstantin Kashin" href="http://kkashin.com/feed.xml"> <script type="text/javascript"> var disqus_shortname = ''; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-29054835-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <!-- MathJax scripts --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['\\[','\\]'], ['$$','$$']]}}); </script> <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Konstantin Kashin<span></span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/projects">projects</a></li> <li><a href="/data">data</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Bootstrap Confidence Interval Methods in R</h1> <p class="post-meta"><time datetime="2013-08-01T00:00:00-04:00" itemprop="datePublished">Aug 1, 2013</time></p> </header> <div class="post-content" itemprop="articleBody"> <p>This post briefly sketches out the types of bootstrapped confidence intervals commonly used, along with code in R for how to calculate them from scratch. Specifically, I focus on nonparametric confidence intervals. The post is structured around the list of bootstrap confidence interval methods provided by Canty et al. (1996). This is just a quick introduction into the world of bootstrapping - for an excellent R package for doing all sorts of bootstrapping, see the <a href="http://cran.r-project.org/web/packages/boot/boot.pdf">boot package</a> by Brian Ripley.</p> <p><br /> Suppose that $x_1, x_2, …, x_n \sim f(\theta)$, where $f(\cdot)$ is some arbitrary probability distribution. We are interested in estimating $\theta$. Let $\hat{\theta}$ be the point estimate of the parameter of interest obtained from the original dataset. Note that these are nonparameteric confidence intervals (that is, we don’t assume that $f$ is a particular parametric family). The example comes from page 201 of DiCiccio and Efron (1996), which contains a dataset on five exams across 22 students (with some missing data). The parameter of interest is the maximum eigenvalue of the empirical covariance matrix. You may download the data <a href="/assets/data/diciccioefron.csv">here</a>. The code for estimating the max eigenvalue is provided at the end of this post. The function is called <code>calculate.max.eigen</code>.</p> <p>Using this function on the dataset, we obtain $\hat{\theta}=216.2$.</p> <p><br /> Now, suppose that we bootstrap the dataset M times and for each of the datasets, calculate $\hat{\theta}^*_{m}$, which is the point estimate of $\theta$ for the mth bootstrapped dataset. The empirical distribution of $\hat{\theta}^*$ is the bootstrap distribution and is an approximation to the sampling distribution for $\hat{\theta}$.</p> <p><br /> To create $M=10000$ bootstrap replicates in R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">BS.eigen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">){</span><span class="w">
    </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
    </span><span class="n">bs.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">,]</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">calculate.max.eigen</span><span class="p">(</span><span class="n">bs.data</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">bs.sampling</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replicate</span><span class="p">(</span><span class="m">10000</span><span class="p">,</span><span class="n">BS.eigen</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">simplify</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure> <p>Here is the distribution of these estimates (with the median of the bootstrapped estimates denoted with the vertical blue line and $\hat{\theta}$ denoted with a vertical red line):</p> <div class="post-image"> <a href="/assets/images/blog/bootstrap_dist.jpg"><img alt="bootstrap distribution" src="/assets/images/blog/bootstrap_dist.jpg" height="320" width="320" /></a> </div> <p>We can then make use of the bootstrap distribution in a number of ways to obtained bootstrapped confidence intervals.</p> <p><br /></p> <h3 id="normal-intervals">Normal intervals</h3> <p>\(\hat{\theta} \pm z_{\alpha/2} \sigma_{bs},\) where $z_{\alpha/2}$ is the $\alpha/2$-quantile of the standard normal distribution and $\sigma_{bs}$ is the standard deviation of the bootstrap distribution. These intervals are justified by asymptotic theory (Central Limit Theorem).</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">theta.hat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.025</span><span class="p">)</span><span class="o">*</span><span class="n">sd</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">)</span><span class="w">
</span><span class="n">theta.hat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="o">*</span><span class="n">sd</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">)</span></code></pre></figure> <p>For our example, we obtain a confidence interval of [202.64,1050.01].</p> <p><br /></p> <h3 id="transformed-normal-intervals">Transformed normal intervals</h3> <p>\(t^{-1}[t(\hat{\theta}) \pm z_{\alpha/2} \sigma_{tbs}],\) where $t(\cdot)$ is a variance-stabilizing square root transformation and $\sigma_{tbs}$ is the standard deviation of the transformed bootstrap distribution (distribution of $\hat{\theta}^*$).</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">theta.hat</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.025</span><span class="p">)</span><span class="o">*</span><span class="n">sd</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">)))</span><span class="o">^</span><span class="m">2</span><span class="w">
</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">theta.hat</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="o">*</span><span class="n">sd</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">)))</span><span class="o">^</span><span class="m">2</span></code></pre></figure> <p>For our example, we obtain a confidence interval of [263.67, 1143.33].</p> <p><br /></p> <h3 id="basic-bootstrap-intervals">Basic bootstrap intervals</h3> \[[2\hat{\theta}-\hat{\theta}^*_{m=(1-\alpha/2)M}, 2\hat{\theta}-\hat{\theta}^*_{m=(\alpha/2)M}]\] <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">2</span><span class="o">*</span><span class="n">theta.hat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="m">0.975</span><span class="p">)</span><span class="w">
</span><span class="m">2</span><span class="o">*</span><span class="n">theta.hat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="m">0.025</span><span class="p">)</span></code></pre></figure> <p>For our example, we obtain a confidence interval of [186.45, 1018.62].</p> <p><br /></p> <h3 id="transformed-basic-bootstrap-intervals">Transformed basic bootstrap intervals</h3> <p>These are basic bootstrap intervals with similar transformation to the transformed normal intervals.</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">theta.hat</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">),</span><span class="m">0.975</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="w">
</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">theta.hat</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">),</span><span class="m">0.025</span><span class="p">))</span><span class="o">^</span><span class="m">2</span></code></pre></figure> <p>For our example, we obtain a confidence interval of [302.76, 1208.00].</p> <p><br /></p> <h3 id="percentile-confidence-intervals">Percentile confidence intervals</h3> \[[\hat{\theta}^*_{m=(1-\alpha/2)M},\hat{\theta}^*_{m=(\alpha/2)M}]\] <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="m">0.975</span><span class="p">)</span><span class="w">
</span><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="m">0.025</span><span class="p">)</span></code></pre></figure> <p>For our example, we obtain a confidence interval of [233.93, 1066.10].</p> <p><br /></p> <h3 id="bca-confidence-intervals">BCa confidence intervals</h3> <p>A refinement on the percentile confidence interval method, designed to increase accuracy. Note that BCa reduces to standard percentile confidence intervals if the bootstrap distribution is unbiased (median of the distribution is equal to the original point estimate) and the acceleration (skewness) is zero.</p> <p><br /> <em>Step 1</em>: Calculate the <em>bias-correction</em> $\hat{z}_0$, which gives the standard normal quantile function of the proportion of bootstrapped estimates less than the original point estimate: \(\hat{z}\_0 = \Phi^{-1} \left\[\dfrac{\sum \{\hat{\theta}^\* &lt; \hat{\theta} \}}{M} \right\]\)</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">z0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">bs.sampling</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">theta.hat</span><span class="p">))</span></code></pre></figure> <p>For our example, $\hat{z}_0$ is 0.194, which indicates a positive bias correction. This follows from the fact that 57.7% of $\hat{\theta}^*$s are below the original point estimate $\hat{\theta}$ (downward bias). We can see this from the plot above since the median of the bootstrap distribution is to the left of the point estimate from the original dataset.</p> <p><br /> <em>Step 2</em>: Calculate the <em>acceleration</em> $a$, which has an interpretation of skewness (more specifically, it measures how rapidly standard error changes on a normalized scale). A non-parametric estimate of $a$ is: \(\hat{a} = \dfrac{1}{6}\dfrac{\sum_{i=1}^n (\hat{\theta}-\hat{\theta}_{(i)})^3}{(\sum_{i=1}^n (\hat{\theta}-\hat{\theta}_{(i)})^2)^{3/2}}.\)</p> <p>where $\hat{\theta}_{(i)}$ is the jackknifed estimate of the parameter, obtained by omitting observation $i$ from the data.</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">jk.theta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
    </span><span class="n">jk.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="p">,]</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">calculate.max.eigen</span><span class="p">(</span><span class="n">jk.data</span><span class="p">))</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">theta.hat</span><span class="o">-</span><span class="n">jk.theta</span><span class="p">)</span><span class="o">^</span><span class="m">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">6</span><span class="o">*</span><span class="nf">sum</span><span class="p">((</span><span class="n">theta.hat</span><span class="o">-</span><span class="n">jk.theta</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="m">3</span><span class="o">/</span><span class="m">2</span><span class="p">))</span></code></pre></figure> <p>For our example, we obtain $a=0.103$.</p> <p><br /> <em>Step 3</em>: The bias-corrected $\alpha/2$ endpoints for the percentile bootstrap confidence interval are then calculated as: \(\hat{\theta}_{BC_a}[\alpha/2] = \hat{G}^{-1} \left( \Phi \left(z_0 + \dfrac{z_0+z_{\alpha/2}}{1-a(z_0+z_{\alpha/2})} \right)\right),\)</p> <p>where $\hat{G}^{-1}(\cdot)$ is the quantile function of the bootstrap distribution.</p> <p><br /> In R:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">q.lb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pnorm</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.025</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.025</span><span class="p">))))</span><span class="w">
</span><span class="n">q.ub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pnorm</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">))))</span><span class="w">

</span><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="n">q.lb</span><span class="p">)</span><span class="w">
</span><span class="n">quantile</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">,</span><span class="n">q.ub</span><span class="p">)</span></code></pre></figure> <p><br /> We find that the BCa percentiles we should be using are actually 9.70% and 99.85% instead of 2.5% and 97.5% for a 95% confidence interval. Thus, we obtain a confidence interval of [322.0132,1320.345].</p> <p><br /> <strong>References:</strong></p> <ul> <li>Canty, A.J., A.C. Davison and D.V. Hinkley. (1996). “Comment on ‘Bootstrap Confidence Intervals’.” <em>Statistical Science</em> 11(3):214-219.</li> <li>DiCiccio, Thomas J. and Bradley Efron. (1996). “Bootstrap Confidence Intervals.” <em>Statistical Science</em> 11(3):189-228.</li> <li>Efron, B. and Tibshirani R. (1993). <em>An Introduction to the Bootstrap</em>. Chapman and Hall, New York.</li> <li>Hall. (1988). “Theoretical comparison of bootstrap confidence intervals (with discussion).” <em>Ann. Statist.</em> 16: 927-985.</li> </ul> <p><br /> <strong>Code for calculating maximum eigenvalue:</strong></p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">calculate.max.eigen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">){</span><span class="w">
    </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ncol</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="n">df.melt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="n">colnames</span><span class="p">(</span><span class="n">df.melt</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"test"</span><span class="p">,</span><span class="s2">"score"</span><span class="p">)</span><span class="w">
    </span><span class="n">df.melt</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="n">k</span><span class="p">))</span><span class="w">
    </span><span class="n">colnames</span><span class="p">(</span><span class="n">df.melt</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"student"</span><span class="w">
    </span><span class="n">lm.out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">score</span><span class="o">~</span><span class="n">test</span><span class="o">+</span><span class="n">student</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df.melt</span><span class="p">)</span><span class="w">
    </span><span class="n">score.hat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lm.out</span><span class="p">,</span><span class="w"> </span><span class="n">df.melt</span><span class="p">)</span><span class="w">
    </span><span class="n">data.hat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">score.hat</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
    </span><span class="n">demeaned.hat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">data.hat</span><span class="p">,</span><span class="n">MARGIN</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">-</span><span class="n">colMeans</span><span class="p">(</span><span class="n">data.hat</span><span class="p">))</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">eigen</span><span class="p">(</span><span class="n">demeaned.hat</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">demeaned.hat</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">only.values</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="o">$</span><span class="n">values</span><span class="p">))</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <p><br /> <strong>Code for density plot:</strong></p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">bs.theta</span><span class="o">=</span><span class="n">bs.sampling</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bs.theta</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_density</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"coral"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">theta.hat</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">median</span><span class="p">(</span><span class="n">bs.sampling</span><span class="p">)),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">"Bootstrapped Estimate of Max Eigenvalue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Density"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure> </div> <div class="post-nav"> <a rel="prev" class="prev" href="/2013/using-ggplot2-to-plot-regression-coefficients-with-confidence-intervals/">&larr; Using ggplot2 to Plot Regression Coefficients with Confidence Intervals</a> <a rel="next" class="next" href="/2013/note-on-bivariate-regression/">Note on Bivariate Regression &rarr;</a> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2024 Konstantin Kashin. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</small> <small class="pull-right"> <ul class="contact-list"> <li> <a href="https://linkedin.com/in/konstantin-kashin-8939a492"><span class="icon"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn icon</title><path fill="#828282" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg> </span></a> </li> <li> <a href="https://github.com/kkashin"><span class="icon icon--github"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path fill="#828282" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg> </span></a> </li> <li> <a href="https://twitter.com/@kostyakashin"><span class="icon icon--twitter"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter icon</title><path fill="#828282" d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/></svg> </span></a> </li> </ul></small> </div> </footer> </main> </body> </html>
