<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Using ggplot2 to Plot Regression Coefficients with Confidence Intervals | Konstantin Kashin </title> <meta name="description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta name="keywords" content="artificial intelligence, AI, data science, engineering, causal inference, A/B testing, experimentation, optimization"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Konstantin Kashin"> <meta property="article:section" content="blog"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2013-07-10 00:00:00 -0400"> <meta property="og:url" content="http://localhost:4000/2013/using-ggplot2-to-plot-regression-coefficients-with-confidence-intervals/"> <meta property="og:title" content=" Using ggplot2 to Plot Regression Coefficients with Confidence Intervals | Konstantin Kashin "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta property="og:site_name" content="Konstantin Kashin"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Using ggplot2 to Plot Regression Coefficients with Confidence Intervals | Konstantin Kashin "> <meta name="twitter:description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Using ggplot2 to Plot Regression Coefficients with Confidence Intervals | Konstantin Kashin "> <meta itemprop="description" content=" Konstantin Kashin is an Engineering Manager at Meta, interested in AI, causal inference, experimentation, and optimization. "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="shortcut icon" type="image/png" href="/assets/images/favicon-32x32.png"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2013/using-ggplot2-to-plot-regression-coefficients-with-confidence-intervals/"> <link rel="alternate" type="application/rss+xml" title="Konstantin Kashin" href="http://localhost:4000/feed.xml"> <script type="text/javascript"> var disqus_shortname = ''; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-29054835-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <!-- MathJax scripts --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['\\[','\\]'], ['$$','$$']]}}); </script> <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Konstantin Kashin<span></span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/projects">projects</a></li> <li><a href="/data">data</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Using ggplot2 to Plot Regression Coefficients with Confidence Intervals</h1> <p class="post-meta"><time datetime="2013-07-10T00:00:00-04:00" itemprop="datePublished">Jul 10, 2013</time></p> </header> <div class="post-content" itemprop="articleBody"> <p>A graphical approach to displaying regression coefficients / effect sizes across multiple specifications can often be significantly more powerful and intuitive than presenting a regression table. Moreover, we can easily express uncertainty in the form of confidence intervals around our estimates. As a quick example, suppose that we wanted to compare the effect of British colonial status upon country-level corruption across multiple specifications and two methods (OLS and WLS) from the following paper: Treisman, Daniel. 2000. “The causes of corruption: a cross-national study,” <em>Journal of Public Economics</em> 76: 399-457.</p> <p><br /> Specifically, the dependent variable is TI98, the perceived corruption score calculated by Transparency International for 1998. The variable whose effect we seek is an indicator that equals 1 if the country is a former British colony or the UK, and 0 otherwise. I took the coefficients and associated standard errors on British colonial status from Tables 2 and 3 across the 5 different specifications where TI98 is the dependent variable. I then entered them into a data frame with the following structure:</p> <p><br /></p> <table> <tr> <td> </td> <td>coef</td> <td>se</td> <td> method</td><td>specification </td> <td>lb </td> <td>ub </td> </tr> <tr> <td>1 </td> <td> -1.99</td> <td>1.01</td> <td>WLS</td> <td>1</td> <td>-3.969564</td> <td>-0.01043638</td></tr> <tr> <td>2</td> <td>-1.56</td> <td>0.59</td> <td>WLS</td> <td>2</td> <td>-2.716379</td> <td>-0.40362125</td></tr> <tr> <td>3</td> <td>-1.25</td> <td>0.52</td> <td>WLS</td> <td>3 </td> <td>-2.269181</td> <td> -0.23081873</td></tr> <tr> <td>4</td> <td>-1.20</td> <td>0.54</td> <td>WLS </td> <td>4 </td> <td> -2.258381</td> <td> -0.14161945</td></tr> <tr> <td>5</td> <td>-1.04</td> <td>0.79</td> <td>WLS</td> <td>5</td> <td>-2.588372</td> <td> 0.50837155</td></tr> <tr> <td>6</td> <td>-1.25</td> <td>0.81</td> <td>OLS</td> <td>1 </td> <td>-2.837571</td> <td> 0.33757083</td></tr> <tr> <td>7</td> <td>-1.08</td> <td>0.54</td> <td>OLS</td> <td>2 </td> <td>-2.138381</td> <td> -0.02161945</td></tr> <tr> <td>8</td> <td>-0.98</td> <td>0.53</td> <td> OLS</td> <td>3 </td> <td>-2.018781</td> <td> 0.05878091</td></tr> <tr> <td>9</td> <td>-0.82</td> <td>0.58</td> <td>OLS</td> <td>4 </td> <td>-1.956779</td> <td> 0.31677911</td></tr> <tr> <td>10</td> <td>-1.06</td> <td>0.96</td> <td>OLS</td> <td>5</td> <td>-2.941565</td> <td> 0.82156543</td></tr> </table> <p><br /> Note that I calculated the upper bound (ub) and lower bound (lb) of the 95% confidence interval using the standard errors provided in the table (I assumed normality holds due to the Central Limit Theorem, which may be questionable in some specifications given small sample sizes).</p> <p><br /> I then generated the following plot:</p> <div class="post-image"> <a href="/assets/images/blog/regcoef_ex1.jpg"><img alt="regression coefficients" src="/assets/images/blog/regcoef_ex1.jpg" height="320" width="320" /></a> </div> <p><br /> Here is the code for making this plot in ggplot2 from the dataframe I provided above:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">treisman</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">specification</span><span class="p">,</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">method</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">method</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Method"</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"coral"</span><span class="p">,</span><span class="s2">"steelblue"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Method"</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">17</span><span class="p">,</span><span class="m">19</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">"Specification"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">specification</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="n">specification</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Estimated effect of being a former British colony or the UK on TI98"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ub</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">0.1</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span></code></pre></figure> <p>The <code>geom_errorbar()</code> function plots the confidence intervals. Note that I use the <code>position_dodge()</code> function to horizontally shift the coefficients and confidence intervals for the same specifications for clarity. The <code>height=NULL</code> option can be omitted. The color and shape for the legend is controlled manually.</p> <p><br /> What would happen if I just set <code>name="Method"</code> for the <code>scale_color_manual</code> command, but left out the <code>scale_shape_manual</code> command, letting it be automatically determined:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">treisman</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">specification</span><span class="p">,</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">method</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">method</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Method"</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"coral"</span><span class="p">,</span><span class="s2">"steelblue"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">"Specification"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">specification</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="n">specification</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Estimated effect of being a former British colony or the UK on TI98"</span><span class="p">)</span><span class="w">   </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ub</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">0.1</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span></code></pre></figure> <p>This would be the plot:</p> <div class="post-image"> <a href="/assets/images/blog/regcoef_ex2.jpg"><img alt="regression coefficients" src="/assets/images/blog/regcoef_ex2.jpg" height="320" width="320" /></a> </div> <p><br /> This happens because I also set the shape of the points to be determined by the method variable, just as for color. I thus I need to manually give the same name to both scales, or else otherwise they are automatically broken up into two legends, one manual titled “Method” and one automatic title “method”.</p> <p><br /> What if I wanted to reorder the ordering of the methods in the plot; that is, if we wanted WLS to be plotted first, then OLS?</p> <p><br /> This can be achieved with the following command before running the first block of code on this page.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span><span class="o">$</span><span class="n">method</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">method</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="n">each</span><span class="o">=</span><span class="m">5</span><span class="p">))</span></code></pre></figure> <p>The result is the following:</p> <div class="post-image"> <a href="/assets/images/blog/regcoef_ex3.jpg"><img alt="regression coefficients" src="/assets/images/blog/regcoef_ex3.jpg" height="320" width="320" /></a> </div> <p><br /> Finally, suppose that we wanted to customize the x-axis labels by tilting them diagonally and changing them to a dark grey. Adding the following extra piece of code to the blocks of code above would accomplish that:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">45</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkgray"</span><span class="p">))</span></code></pre></figure> </div> <div class="post-nav"> <a rel="prev" class="prev" href="/2013/dags-in-r/">&larr; DAGs in R</a> <a rel="next" class="next" href="/2013/bootstrap-confidence-interval-methods-in-r/">Bootstrap Confidence Interval Methods in R &rarr;</a> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2024 Konstantin Kashin. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</small> <small class="pull-right"> <ul class="contact-list"> <li> <a href="https://linkedin.com/in/konstantin-kashin-8939a492"><span class="icon"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn icon</title><path fill="#828282" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg> </span></a> </li> <li> <a href="https://github.com/kkashin"><span class="icon icon--github"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path fill="#828282" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg> </span></a> </li> <li> <a href="https://twitter.com/@kostyakashin"><span class="icon icon--twitter"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter icon</title><path fill="#828282" d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/></svg> </span></a> </li> </ul></small> </div> </footer> </main> </body> </html>
